#!/bin/bash
# Show PRs from repos I've contributed to in the last week

GREEN='\033[0;32m'
YELLOW='\033[0;33m'
GREY='\033[0;90m'
NC='\033[0m'

gh search prs --author=@me --updated=">=$(date -v-7d +%Y-%m-%d)" --state=open --limit=20 \
  --json repository,title,number,url \
  --jq '.[] | "\(.number)|\(.repository.name)|\(.title)|\(.url)"' | while IFS='|' read -r num repo title url; do
  printf "${GREEN}#%s${NC} %s: %s\n" "$num" "$repo" "$title"
  printf "                         ${GREY}%s${NC}\n" "$url"
done

echo ""
printf "${GREY}Review requests:${NC}\n"
gh search prs --review-requested=@me --state=open --limit=10 \
  --json repository,title,number,author,url \
  --jq '.[] | "\(.number)|\(.repository.name)|\(.title)|\(.author.login)|\(.url)"' | while IFS='|' read -r num repo title author url; do
  printf "${YELLOW}#%s${NC} %s: %s ${GREY}(%s)${NC}\n" "$num" "$repo" "$title" "$author"
  printf "                         ${GREY}%s${NC}\n" "$url"
done
